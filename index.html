<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–ø–∏—Å—å –≤ –±–∞—Ä–±–µ—Ä—à–æ–ø</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .form-container {
      background-color: #fff;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 600px;
      margin: 40px auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    input,
    select,
    button {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    .price-info {
      font-weight: bold;
      color: #28a745;
      text-align: center;
      margin-top: -10px;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th,
    td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th:last-child,
    td:last-child {
      text-align: center;
    }

    .btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #6c757d;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      margin-right: 10px;
      transition: opacity 0.3s ease;
    }

    .btn-admin {
      background-color: #007bff;
      margin-left: 10px;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .success-message {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }
  </style>
</head>
<body>

  <div class="form-container">
    <h1>–ó–∞–ø–∏—Å—å –≤ –±–∞—Ä–±–µ—Ä—à–æ–ø</h1>

    <form id="bookingForm">
      <div class="form-group">
        <label for="name">–ò–º—è:</label>
        <input type="text" id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required />
      </div>

      <div class="form-group">
        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
        <input type="tel" id="phone" placeholder="+7 (999) 999-99-99" required />
      </div>

      <div class="form-group">
        <label for="service">–£—Å–ª—É–≥–∞:</label>
        <select id="service" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
          <option value="–°—Ç—Ä–∏–∂–∫–∞">–°—Ç—Ä–∏–∂–∫–∞</option>
          <option value="–ë—Ä–∏—Ç—å—ë">–ë—Ä–∏—Ç—å—ë</option>
          <option value="–£—Å—ã">–£—Å—ã</option>
          <option value="–ú—ã—Ç—å–µ –≥–æ–ª–æ–≤—ã">–ú—ã—Ç—å–µ –≥–æ–ª–æ–≤—ã</option>
        </select>
      </div>

      <div class="form-group">
        <label for="master">–ú–∞—Å—Ç–µ—Ä:</label>
        <select id="master" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞</option>
          <option value="–ú–∏—Ö–∞–∏–ª">–ú–∏—Ö–∞–∏–ª</option>
          <option value="–ê–ª–µ–∫—Å–∞–Ω–¥—Ä">–ê–ª–µ–∫—Å–∞–Ω–¥—Ä</option>
          <option value="–î–º–∏—Ç—Ä–∏–π">–î–º–∏—Ç—Ä–∏–π</option>
          <option value="–ï–≤–≥–µ–Ω–∏–π">–ï–≤–≥–µ–Ω–∏–π</option>
          <option value="–ê–Ω–∞—Å—Ç–∞—Å–∏—è">–ê–Ω–∞—Å—Ç–∞—Å–∏—è</option>
        </select>
      </div>

      <!-- –ü–æ–ª–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω—ã -->
      <div class="price-info" id="priceDisplay">–¶–µ–Ω–∞: –Ω–µ —É–∫–∞–∑–∞–Ω–∞</div>

      <div class="form-group">
        <label for="datetime">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</label>
        <input type="datetime-local" id="datetime" required />
      </div>

      <button type="submit">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
    </form>

    <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ -->
    <div style="text-align: center; margin-bottom: 20px;">
      <a href="bookings.html" class="btn">üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏</a>
      <a href="admin.html" class="btn btn-admin">üìù –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</a>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π -->
    <h2 style="text-align: center;">–í—Å–µ –∑–∞–ø–∏—Å–∏:</h2>
    <table id="bookingsTable">
      <thead>
        <tr>
          <th>–ò–º—è</th>
          <th>–£—Å–ª—É–≥–∞</th>
          <th>–ú–∞—Å—Ç–µ—Ä</th>
          <th>–¶–µ–Ω–∞</th>
          <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="success-message" id="successMessage"></div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π JS -->
  <script src="app.js"></script>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script>
    async function loadBookings() {
      try {
        const response = await fetch('/api/bookings');
        const bookings = await response.json();
        const tbody = document.querySelector('#bookingsTable tbody');
        tbody.innerHTML = '';

        if (bookings.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.</td></tr>';
          return;
        }

        bookings.forEach(booking => {
          const tr = document.createElement('tr');

          tr.innerHTML = `
            <td>${booking.name}</td>
            <td>${booking.service}</td>
            <td>${booking.master || '-'}</td>
            <td>${booking.price || 0} ‚ÇΩ</td>
            <td>${new Date(booking.datetime).toLocaleString()}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π:', err);
        tbody.innerHTML = '<tr><td colspan="5">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</td></tr>';
      }
    }

    // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã ---
    document.getElementById('bookingForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const data = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        service: document.getElementById('service').value,
        master: document.getElementById('master').value,
        datetime: document.getElementById('datetime').value,
        price: calculatePrice(
          document.getElementById('service').value,
          document.getElementById('master').value
        )
      };

      if (!data.name || !data.phone || !data.service || !data.master || !data.datetime) {
        const messageDiv = document.getElementById('successMessage');
        messageDiv.style.color = 'red';
        messageDiv.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.';
        return;
      }

      const response = await fetch('/api/book', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const messageDiv = document.getElementById('successMessage');

      if (response.ok) {
        messageDiv.style.color = 'green';
        messageDiv.textContent = '–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å!';
        this.reset();
        document.getElementById('priceDisplay').textContent = '–¶–µ–Ω–∞: –Ω–µ —É–∫–∞–∑–∞–Ω–∞';

        loadBookings(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
      } else {
        messageDiv.style.color = 'red';
        messageDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.';
      }
    });

    // –†–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
    const basePrices = {
      '–°—Ç—Ä–∏–∂–∫–∞': 500,
      '–ë—Ä–∏—Ç—å—ë': 300,
      '–£—Å—ã': 200,
      '–ú—ã—Ç—å–µ –≥–æ–ª–æ–≤—ã': 150
    };

    const topMasters = ['–ú–∏—Ö–∞–∏–ª', '–ê–Ω–∞—Å—Ç–∞—Å–∏—è'];
    const priceMultiplier = 1.5;

    function calculatePrice(service, master) {
      let price = basePrices[service] || 0;
      if (topMasters.includes(master)) {
        price = Math.round(price * priceMultiplier);
      }
      return price;
    }

    function updatePrice() {
      const service = document.getElementById('service').value;
      const master = document.getElementById('master').value;

      if (!service || !master) {
        document.getElementById('priceDisplay').textContent = '–¶–µ–Ω–∞: –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
        return;
      }

      const price = calculatePrice(service, master);
      document.getElementById('priceDisplay').textContent = `–¶–µ–Ω–∞: ${price} —Ä—É–±.`;
    }

    document.getElementById('service').addEventListener('change', updatePrice);
    document.getElementById('master').addEventListener('change', updatePrice);

    window.onload = () => {
      loadBookings();
    };

    setInterval(loadBookings, 10000);
  </script>
</body>
</html>